# Laravel Exception Notifications

An easy way to send Notifications via email and slack channels along with full stack trace whenever an exception occurs on the server for Laravel applications.

![sneaker example image](sneaker.png?raw=true "Sneaker")

## Install

### Install via Composer

#### For Laravel <= 5.2, please use the [v1 branch](https://github.com/squareboat/sneaker/tree/v1)!

```
$ composer require squareboat/sneaker
```

### Configure Laravel
Once installation operation is complete, simply add both the service provider and facade classes to your project's `config/app.php` file:

#### Service Provider

```php
SquareBoat\Sneaker\SneakerServiceProvider::class,
```

#### Facade

```php
'Sneaker' => SquareBoat\Sneaker\Facades\Sneaker::class,
```

### Add Sneaker's Exception Capturing
Add exception capturing to `app/Exceptions/Handler.php`:

```php
public function report(Exception $exception)
{
    if ($this->shouldReport($exception)) {
        Sneaker::captureException($exception);
    }

    parent::report($exception);
}
```

### Configuration

Create the Sneaker configuration file using this command:

```bash
$ php artisan vendor:publish --provider="SquareBoat\Sneaker\SneakerServiceProvider"
```

The config file will be published in `config/sneaker.php`

Following are the configuration attributes used for the Sneaker.

#### silent

The package comes with `'silent' => false,` configuration by default. It means that Sneaker is configured to send notifications when an exception occurs.

```php
'silent' => env('SNEAKER_SILENT', false),
```
To avoid sending notifications on your development environment set `SNEAKER_SILENT=true` in your `.env` file.

#### capture

It contains the list of the exception types that should be captured. You can add your exceptions tyeps here for which you want to send notifiactions.

By defautl we have `'*'` in the array, which means that we will capture all the exceptions that occurs in the application.

```php
'capture' => [
    '*'
],
```

To explicitly list the exception types, remove `'*'` and define them below as:

```php
'capture' => [
    Symfony\Component\Debug\Exception\FatalErrorException::class,
    ...
],
```

#### notifications

It lists the channels on which the notification will be delivered. Senaker by default supports `'mail'` and `'slack'` channels.

```bash
'notifications' => [
    'mail',
    'slack',
],
```

#### mail

### to
The email address used to deliver the notification.

```php
'mail' => [
    'to' => [
        // 'your@email.com',
    ],
],
```

#### slack

### webhook_url
The webhook URL to which the notification should be delivered. Webhook URLs may be generated by adding an "Incoming Webhook" service to your Slack team.

```php
'slack' => [
    'webhook_url' => env('SNEAKER_SLACK_WEBHOOK_URL'),
],
```

#### ignored_bots

This is the list of bots for which we should NOT send error notifications.

```php
'ignored_bots' => [
    'googlebot',        // Googlebot
    'bingbot',          // Microsoft Bingbot
    'slurp',            // Yahoo! Slurp
    'ia_archiver',      // Alexa
],
```

## Adding Context
Sometimes you may need more information for debugging when an exception occurs like which user got the excpetion, app version, etc...

For that we can add some context as:

### User Context
You can add user context to be send in each notification.

```php
Sneaker::userContext(function() {
    return [
        'ID' => 10,
        'Name' => 'John Doe'
    ];
});
```

### Extra Context
You can add extra context to be send in each notification.

```php
Sneaker::extraContext(function() {
    return [
        'App' => 'Project X',
        'Version' => 'v3.0.0'
    ];
});
```

The best place to add them is in `report()` method of `app/Exceptions/Handler.php`:

```php
public function report(Exception $exception)
{
    Sneaker::userContext(function() {
        // return user context array
    });
    
    Sneaker::extraContext(function() {
        // return extra context array
    });

    if ($this->shouldReport($exception)) {
        Sneaker::captureException($exception);
    }

    parent::report($exception);
}
```

## Sneak
### Test your integration
To verify that Sneaker is configured correctly and our integration is working, use `sneaker:sneak` Artisan command:

```bash
$ php artisan sneaker:sneak
```

A `SquareBoat\Sneaker\Exceptions\DummyException` class will be thrown and captured by Sneaker. The captured exception will appear in your configured email immediately.

You can also add the verbosity flags `-v/-vv/-vvv`.

## Security

If you discover any security related issues, please email amit.gupta@squareboat.com instead of using the issue tracker.

## Credits

- [Amit Gupta](https://github.com/akaamitgupta)
- [All Contributors](../../contributors)

## About SquareBoat

[SquareBoat](https://squareboat.com) is a startup focused, product development company based in Gurgaon, India. You'll find an overview of all our open source projects [on GitHub](https://github.com/squareboat).

# License

The MIT License. Please see [License File](LICENSE.md) for more information. Copyright Â© 2016 [SquareBoat](https://squareboat.com)
